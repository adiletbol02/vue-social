{"version":3,"file":"js/990.e079bf58.js","mappings":"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","sources":["webpack://vue-social/./node_modules/vue-loader/dist/exportHelper.js","webpack://vue-social/./src/views/ProfilePage.vue","webpack://vue-social/./src/views/ProfilePage.vue?ccbe"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","<template>\r\n  <v-container>\r\n    <v-row justify=\"center\">\r\n      <v-col cols=\"12\" md=\"6\">\r\n        <v-card class=\"pa-5\">\r\n          <v-card-title class=\"text-h5 text-center\" v-if=\"!isEditing\">\r\n            My Profile\r\n            <v-btn @click=\"isEditing = true\" color=\"primary\" small>Edit</v-btn>\r\n          </v-card-title>\r\n\r\n          <v-card-title class=\"text-h5 text-center\" v-else>\r\n            Edit Profile\r\n          </v-card-title>\r\n\r\n          <v-card-text>\r\n            <div v-if=\"!isEditing\">\r\n              <img\r\n                :src=\"user.photoURL || 'default-profile.png'\"\r\n                alt=\"Profile Picture\"\r\n                class=\"profile-image\"\r\n              />\r\n              <p><strong>Display Name:</strong> {{ user.displayName }}</p>\r\n              <p><strong>Email:</strong> {{ user.email }}</p>\r\n              <p><strong>Bio:</strong> {{ firestoreBio || \"No bio yet.\" }}</p>\r\n            </div>\r\n\r\n            <v-form v-else @submit.prevent=\"updateProfile\">\r\n              <v-file-input\r\n                v-model=\"profileImage\"\r\n                label=\"Profile Image\"\r\n                accept=\"image/*\"\r\n              ></v-file-input>\r\n              <v-text-field\r\n                v-model=\"displayName\"\r\n                label=\"Display Name\"\r\n                required\r\n              ></v-text-field>\r\n              <v-textarea v-model=\"bio\" label=\"Bio\" rows=\"3\"></v-textarea>\r\n              <v-btn type=\"submit\" color=\"primary\" :disabled=\"loading\">\r\n                Save Changes\r\n              </v-btn>\r\n              <v-btn @click=\"cancel\" color=\"secondary\" :disabled=\"loading\">\r\n                Cancel\r\n              </v-btn>\r\n              <div v-if=\"errorMessage\" class=\"text-error\">\r\n                {{ errorMessage }}\r\n              </div>\r\n            </v-form>\r\n          </v-card-text>\r\n        </v-card>\r\n      </v-col>\r\n    </v-row>\r\n  </v-container>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nimport { getAuth, updateProfile as updateFirebaseUser } from \"firebase/auth\";\r\nimport {\r\n  getStorage,\r\n  ref as storageRef,\r\n  uploadBytes,\r\n  getDownloadURL,\r\n} from \"firebase/storage\";\r\nimport {\r\n  getFirestore,\r\n  doc,\r\n  getDoc,\r\n  setDoc,\r\n  deleteDoc,\r\n  updateDoc,\r\n} from \"firebase/firestore\";\r\nimport { useRouter } from \"vue-router\";\r\n\r\nconst router = useRouter();\r\nconst auth = getAuth();\r\nconst storage = getStorage();\r\nconst db = getFirestore();\r\n\r\nconst isEditing = ref(false);\r\nconst profileImage = ref(null);\r\nconst displayName = ref(\"\");\r\nconst bio = ref(\"\");\r\nconst loading = ref(false);\r\nconst errorMessage = ref(null);\r\n\r\nconst firestoreBio = ref(null);\r\n\r\nconst user = ref(auth.currentUser);\r\n\r\nonMounted(async () => {\r\n  // Fetch user data from Firestore\r\n  const userDocRef = doc(db, \"users\", user.value.uid);\r\n  const userDocSnap = await getDoc(userDocRef);\r\n  if (user.value) {\r\n    // Fetch user data from Firestore\r\n    await fetchFirestoreData();\r\n  }\r\n\r\n  if (userDocSnap.exists()) {\r\n    const userData = userDocSnap.data();\r\n    displayName.value = userData.displayName || \"\";\r\n    user.value.bio = userData.bio || \"\";\r\n  } else {\r\n    console.warn(\"User document not found in Firestore!\");\r\n  }\r\n});\r\n\r\nconst fetchFirestoreData = async () => {\r\n  const userDocRef = doc(db, \"users\", user.value.uid);\r\n  const userDocSnap = await getDoc(userDocRef);\r\n\r\n  if (userDocSnap.exists()) {\r\n    const userData = userDocSnap.data();\r\n    displayName.value = userData.displayName || \"\";\r\n    firestoreBio.value = userData.bio || \"\";\r\n  } else {\r\n    console.warn(\"User document not found in Firestore!\");\r\n  }\r\n};\r\n\r\n// Watch for changes to isEditing and update the bio field\r\nwatch(isEditing, (newVal) => {\r\n  if (newVal) {\r\n    // When entering edit mode, update the bio field\r\n    bio.value = firestoreBio.value || \"\";\r\n  }\r\n});\r\n\r\nconst updateProfile = async () => {\r\n  loading.value = true;\r\n  errorMessage.value = null;\r\n\r\n  try {\r\n    const user = auth.currentUser;\r\n    const updates = {};\r\n    const userDocRef = doc(db, \"users\", user.uid);\r\n\r\n    if (profileImage.value) {\r\n      const imageRef = storageRef(storage, `profile-images/${user.uid}`);\r\n      await uploadBytes(imageRef, profileImage.value);\r\n      const downloadURL = await getDownloadURL(imageRef);\r\n      updates.photoURL = downloadURL;\r\n    }\r\n\r\n    if (displayName.value !== user.displayName) {\r\n      updates.displayName = displayName.value;\r\n\r\n      // Update usernames collection\r\n      const userDocSnap = await getDoc(userDocRef);\r\n\r\n      if (userDocSnap.exists()) {\r\n        const currentUsername = userDocSnap.data().displayName;\r\n\r\n        // Delete old username document\r\n        await deleteDoc(doc(db, \"usernames\", currentUsername));\r\n\r\n        // Create new username document\r\n        await setDoc(doc(db, \"usernames\", displayName.value), {\r\n          uid: user.uid,\r\n        });\r\n      }\r\n    }\r\n\r\n    // Update user profile in Firebase Auth and Firestore simultaneously\r\n    await Promise.all([\r\n      updateFirebaseUser(user, updates),\r\n      updateDoc(userDocRef, {\r\n        displayName: displayName.value,\r\n        bio: bio.value,\r\n        ...(profileImage.value && { photoURL: updates.photoURL }),\r\n      }),\r\n    ]);\r\n\r\n    // Update local reactive properties after successful update\r\n    firestoreBio.value = bio.value;\r\n    if (updates.photoURL && user.value) {\r\n      // Check if user.value exists\r\n      user.value.photoURL = updates.photoURL;\r\n    }\r\n\r\n    router.push(\"/vue-social/profile\");\r\n  } catch (error) {\r\n    errorMessage.value = error.message;\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\nconst cancel = () => {\r\n  isEditing.value = false;\r\n  // Reset form fields if needed\r\n  displayName.value = user.value.displayName || \"\";\r\n  bio.value = user.value.bio || \"\";\r\n  profileImage.value = null;\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.profile-image {\r\n  width: 150px;\r\n  height: 150px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n  margin-bottom: 16px;\r\n}\r\n</style>\r\n","import script from \"./ProfilePage.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./ProfilePage.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./ProfilePage.vue?vue&type=style&index=0&id=12a1d643&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-12a1d643\"]])\n\nexport default __exports__"],"names":["exports","sfc","props","target","__vccOpts","key","val","router","useRouter","auth","getAuth","storage","getStorage","db","getFirestore","isEditing","ref","profileImage","displayName","bio","loading","errorMessage","firestoreBio","user","currentUser","onMounted","async","userDocRef","doc","value","uid","userDocSnap","getDoc","fetchFirestoreData","exists","userData","data","console","warn","watch","newVal","updateProfile","updates","imageRef","storageRef","uploadBytes","downloadURL","getDownloadURL","photoURL","currentUsername","deleteDoc","setDoc","Promise","all","updateFirebaseUser","updateDoc","push","error","message","cancel","__exports__"],"sourceRoot":""}