"use strict";(self["webpackChunkvue_social"]=self["webpackChunkvue_social"]||[]).push([[927],{6262:function(e,t){t.A=(e,t)=>{const s=e.__vccOpts||e;for(const[o,a]of t)s[o]=a;return s}},7927:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var o=s(641),a=s(3751),r=s(33);const n={key:0},l={key:1};function u(e,t,s,u,c,i){const d=(0,o.g2)("v-btn"),v=(0,o.g2)("v-text-field"),g=(0,o.g2)("v-file-input"),m=(0,o.g2)("v-form"),p=(0,o.g2)("v-card"),f=(0,o.g2)("v-col"),k=(0,o.g2)("v-row"),b=(0,o.g2)("v-container"),h=(0,o.g2)("PostContent"),_=(0,o.g2)("v-main");return(0,o.uX)(),(0,o.Wv)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(b,{class:"fixed-header"},{default:(0,o.k6)((()=>[(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)(p,{style:{"text-align":"center"},class:"pa-4"},{default:(0,o.k6)((()=>[!u.showForm&&u.currentUser&&u.currentUser.isAdmin?((0,o.uX)(),(0,o.Wv)(d,{key:0,color:"primary",onClick:t[0]||(t[0]=e=>u.showForm=!0)},{default:(0,o.k6)((()=>[(0,o.eW)(" Create Post ")])),_:1})):(0,o.Q3)("",!0),u.showForm?((0,o.uX)(),(0,o.Wv)(m,{key:1,onSubmit:(0,a.D$)(u.createPost,["prevent"]),class:"post-form"},{default:(0,o.k6)((()=>[(0,o.bF)(v,{modelValue:u.newPostText,"onUpdate:modelValue":t[1]||(t[1]=e=>u.newPostText=e),label:"What's on your mind?",outlined:"",dense:""},null,8,["modelValue"]),(0,o.bF)(g,{modelValue:u.newPostImage,"onUpdate:modelValue":t[2]||(t[2]=e=>u.newPostImage=e),label:"Attach an image",outlined:"",dense:"",accept:"image/*"},null,8,["modelValue"]),(0,o.bF)(d,{type:"submit",color:"primary",disabled:u.isCreatingPost},{default:(0,o.k6)((()=>[(0,o.eW)((0,r.v_)(u.isCreatingPost?"Posting...":"Post"),1)])),_:1},8,["disabled"]),(0,o.bF)(d,{text:"",onClick:t[3]||(t[3]=e=>u.showForm=!1),class:"cancel-btn"},{default:(0,o.k6)((()=>[(0,o.eW)(" Cancel ")])),_:1})])),_:1},8,["onSubmit"])):(0,o.Q3)("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(b,{class:"main-content"},{default:(0,o.k6)((()=>[(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,null,{default:(0,o.k6)((()=>[u.isLoading?((0,o.uX)(),(0,o.CE)("div",n,"Loading posts...")):u.fetchError?((0,o.uX)(),(0,o.CE)("div",l," Error fetching posts: "+(0,r.v_)(u.fetchError),1)):((0,o.uX)(!0),(0,o.CE)(o.FK,{key:2},(0,o.pI)(u.news,(e=>((0,o.uX)(),(0,o.Wv)(h,{key:e.id,post:e,users:u.users},null,8,["post","users"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var c=s(1394),i=s(953),d=s(1884),v=s(5904),g=s(2605),m={components:{PostContent:g.A},setup(){const e=(0,i.KR)([]),t=(0,i.KR)({}),s=(0,i.KR)(!0),a=(0,i.KR)(null),r=(0,i.KR)(""),n=(0,i.KR)(null),l=(0,i.KR)(!1),u=(0,i.KR)(!1),g=(0,i.KR)(c.j.currentUser),m=async()=>{if(""!==r.value.trim()){l.value=!0;try{let e=null;if(n.value){const t=(0,v.KR)(c.I,`news/${(new Date).toISOString()}_${n.value.name}`);await(0,v.D)(t,n.value),e=await(0,v.qk)(t)}await(0,d.gS)((0,d.rJ)(c.db,"news"),{text:r.value,imageUrl:e,createdAt:(0,d.O5)(),userId:c.j.currentUser.uid,username:c.j.currentUser.displayName,userPhotoURL:c.j.currentUser.photoURL}),r.value="",n.value=null}catch(e){console.error("Error creating post:",e),alert("Error creating post: "+e.message)}finally{l.value=!1}}else alert("Post text cannot be empty")};return(0,o.sV)((()=>{const r=(0,d.rJ)(c.db,"news"),n=(0,d.P)(r,(0,d.My)("createdAt","desc")),l=(0,d.aQ)(n,(t=>{console.log("Fetching posts..."),t.empty?console.log("No posts found."):(e.value=t.docs.map((e=>({id:e.id,...e.data()}))),console.log("Posts loaded:",e.value)),s.value=!1}),(e=>{a.value=e.message,console.error("Error fetching posts:",e),s.value=!1})),u=(0,d.rJ)(c.db,"users"),i=(0,d.aQ)(u,(e=>{console.log("Fetching users..."),e.forEach((e=>{t.value[e.id]=e.data()})),console.log("Users loaded:",t.value)}),(e=>{console.error("Error fetching users:",e)})),v=c.j.onAuthStateChanged((e=>{g.value=e}));(0,o.xo)((()=>{l(),i(),v()}))})),{news:e,users:t,isLoading:s,fetchError:a,newPostText:r,newPostImage:n,createPost:m,isCreatingPost:l,showForm:u,currentUser:g}}},p=s(6262);const f=(0,p.A)(m,[["render",u],["__scopeId","data-v-4709586d"]]);var k=f},2605:function(e,t,s){s.d(t,{A:function(){return k}});var o=s(641),a=s(33);const r={key:0},n=["src"],l={key:1,src:"https://firebasestorage.googleapis.com/v0/b/vuesocial-5ebd2.appspot.com/o/system-images%2Faccount.png?alt=media&token=3d774fec-20ee-487d-a027-d01bc4a7b2e0",alt:"Profile Picture",class:"avatar-img"},u={class:"username"},c={class:"text--secondary"};function i(e,t,s,i,d,v){const g=(0,o.g2)("v-avatar"),m=(0,o.g2)("v-card-title"),p=(0,o.g2)("v-card-text"),f=(0,o.g2)("v-img"),k=(0,o.g2)("v-card");return(0,o.uX)(),(0,o.Wv)(k,{class:"mb-3"},{default:(0,o.k6)((()=>[(0,o.bF)(m,{class:"d-flex align-center"},{default:(0,o.k6)((()=>[i.user?((0,o.uX)(),(0,o.CE)("div",r,[(0,o.bF)(g,{class:"mr-3"},{default:(0,o.k6)((()=>[i.user.photoURL?((0,o.uX)(),(0,o.CE)("img",{key:0,src:i.user.photoURL,alt:"Profile Picture",class:"avatar-img"},null,8,n)):((0,o.uX)(),(0,o.CE)("img",l))])),_:1}),(0,o.Lk)("div",null,[(0,o.Lk)("div",u,(0,a.v_)(i.user.displayName||"Unknown User"),1),(0,o.Lk)("div",c,(0,a.v_)(i.postTime),1)])])):(0,o.Q3)("",!0)])),_:1}),(0,o.bF)(p,{class:"post-text"},{default:(0,o.k6)((()=>[(0,o.eW)((0,a.v_)(s.post.text),1)])),_:1}),s.post.imageUrl?((0,o.uX)(),(0,o.Wv)(f,{key:0,src:s.post.imageUrl,height:"350px",class:"post-image",contain:""},null,8,["src"])):(0,o.Q3)("",!0)])),_:1})}var d=s(953),v=s(1884),g=s(1394),m={props:{post:Object,users:Object},setup(e){const t=(0,d.KR)(null);(0,o.sV)((async()=>{try{const s=(0,v.H9)(g.db,"users",e.post.userId),o=await(0,v.x7)(s);o.exists()?t.value=o.data():console.log("User document not found.")}catch(s){console.error("Error fetching user data:",s)}}));const s=(0,o.EW)((()=>{if(!e.post.createdAt)return"Unknown time";const t=e.post.createdAt.toDate();return t.toLocaleString()}));return{user:t,postTime:s}}},p=s(6262);const f=(0,p.A)(m,[["render",i],["__scopeId","data-v-471a7364"]]);var k=f}}]);
//# sourceMappingURL=927.dda31516.js.map